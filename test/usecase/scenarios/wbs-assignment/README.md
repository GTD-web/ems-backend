# WBS 할당 관리 시나리오

## 식별된 검증해야하는 시나리오

각 하이라키별 시나리오 엔드포인트 순서대로 검증이 되어야 함.

사용되는 컨트롤러
- wbs-assignment-management
- evaluation-period
- dashboard

- **WBS 할당 기본 관리** 
    - POST /admin/evaluation-periods (평가기간 생성) 
    - POST /admin/evaluation-periods/{id}/start (평가기간 시작) 
    - POST /admin/evaluation-criteria/project-assignments (프로젝트 할당 생성 - 선행 조건) 
                - **프로젝트 할당 생성** 
                    - employeeId, projectId, periodId로 프로젝트 할당 생성
                    - WBS 할당 생성 전 필수 선행 조건이므로 먼저 생성
                    - 할당 ID 반환 확인
    - POST /admin/evaluation-criteria/wbs-assignments (WBS 할당 생성) 
                - **할당 생성 검증** 
                    - employeeId, wbsItemId, projectId, periodId로 할당 생성
                    - 프로젝트 할당이 위에서 생성되었으므로 정상 생성됨
                    - assignedBy 자동 설정 (현재 사용자)
                    - 할당 ID 반환 확인
                    - **평가기준 자동 생성 검증** 
                        - WBS 항목에 평가기준이 없는 경우 빈 평가기준 자동 생성 확인
                    - **평가라인 자동 구성 검증** 
                        - 1차 평가자(관리자), 2차 평가자(PM) 자동 설정 확인
                        - PM이 관리자와 같은 경우 2차 평가자 미설정 확인
                - **대시보드 할당 검증** 
                    - GET /admin/dashboard/{evaluationPeriodId}/employees/status (대시보드 직원 현황 조회)
                        - evaluationCriteria.status 확인 (WBS 할당 상태)
                        - evaluationCriteria.assignedWbsCount 확인 (할당된 WBS 수)
                    - GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data (직원 할당 데이터 조회)
                        - employee 정보 확인
                        - projects 배열 확인 (할당된 프로젝트 목록)
                        - projects[].wbsList 배열 확인 (각 프로젝트의 할당된 WBS 목록)
                        - **할당된 WBS ID 검증** 
                            - wbsId로 의도한 WBS가 할당되었는지 확인
                            - wbsName, wbsCode 정보 검증
                            - assignedAt 할당 시점 정보 확인
                            - weight (가중치) 정보 확인
                            - criteria (평가기준) 배열 확인
    - GET /admin/evaluation-criteria/wbs-assignments (WBS 할당 목록 조회) 
        - periodId, employeeId, projectId, wbsItemId로 필터링 가능
        - 페이징 및 정렬 지원
    - GET /admin/evaluation-criteria/wbs-assignments/employee/{employeeId}/period/{periodId} (직원별 할당 WBS 조회) 
        - 특정 직원의 특정 평가기간 할당 WBS 목록
        - WBS 할당 후 조회하여 데이터 검증
        - **대시보드 API 추가 검증** 
            - GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data (직원 할당 데이터 조회)
                - 할당된 WBS의 wbsId 검증
                - WBS 정보 일치 확인
    - GET /admin/evaluation-criteria/wbs-assignments/project/{projectId}/period/{periodId} (프로젝트별 할당 WBS 조회) 
        - 특정 프로젝트의 특정 평가기간 할당 WBS 목록
        - WBS 할당 후 조회하여 데이터 검증
        - **대시보드 API 추가 검증** 
            - GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data (직원 할당 데이터 조회)
                - 할당된 WBS의 wbsId 검증
                - WBS 정보 일치 확인
    - GET /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId}/period/{periodId} (WBS 항목별 할당된 직원 조회) 
        - 특정 WBS 항목의 특정 평가기간 할당된 직원 목록
        - WBS 할당 후 조회하여 데이터 검증
    - GET /admin/evaluation-criteria/wbs-assignments/unassigned (미할당 WBS 항목 조회) 
        - periodId, projectId, employeeId(선택)로 미할당 WBS 항목 목록 조회
    - GET /admin/evaluation-criteria/wbs-assignments/detail (WBS 할당 상세 조회) 
        - employeeId, wbsItemId, projectId, periodId로 상세 정보 조회
        - employee, project, wbsItem, evaluationPeriod 중첩 객체 구조 검증
    - **WBS 대량 할당 관리** 
        - POST /admin/evaluation-criteria/project-assignments/bulk (프로젝트 대량 할당 - 선행 조건) 
            - 여러 직원을 여러 프로젝트에 한 번에 할당
            - assignments 배열로 다중 할당 처리
            - WBS 대량 할당 전 필수 선행 조건이므로 먼저 생성
        - POST /admin/evaluation-criteria/wbs-assignments/bulk (WBS 대량 할당) 
            - 여러 직원을 여러 WBS 항목에 한 번에 할당
            - assignments 배열로 다중 할당 처리
            - 프로젝트 할당이 위에서 생성되었으므로 정상 생성됨
            - **평가기준 자동 생성 검증** 
                - 각 WBS 항목에 평가기준이 없는 경우 빈 평가기준 자동 생성 확인
            - **평가라인 자동 구성 검증** 
                - 각 할당마다 1차, 2차 평가자 자동 설정 확인
            - **대시보드 API 대량 할당 검증** 
                - 각 할당에 대해 GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data 호출
                - 할당된 WBS의 wbsId, wbsName, wbsCode 검증
                - 할당 시점(assignedAt) 및 가중치(weight) 정보 확인
                - 평가기준(criteria) 배열 확인
        - PATCH /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId}/order (WBS 할당 순서 변경) 
            - direction: "up" | "down"으로 순서 변경
            - employeeId, projectId, periodId를 body로 전달
            - **순서 변경 검증** 
                - 여러 WBS 할당 후 순서 변경 테스트
                - 변경 전후 WBS 순서 비교 검증
                - GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data (직원 할당 데이터 조회)
                    - projects[].wbsList 배열의 실제 순서 변경 확인
                    - summary.totalWbsCount 확인
                    - 첫 번째 WBS가 변경되었는지 검증
                    - **대시보드 API 순서 변경 검증** 
                        - 할당된 WBS의 wbsId로 정확한 WBS가 순서 변경되었는지 확인
                        - WBS 정보(wbsName, wbsCode) 일치 확인
        - DELETE /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId} (WBS 할당 취소) 
            - employeeId, projectId, periodId를 body로 전달
            - 할당 취소
            - HTTP 200 응답으로 성공 확인
            - **평가기준 정리 검증** 
                - 해당 WBS의 마지막 할당인 경우 평가기준도 자동 삭제 확인
                - 다른 할당이 남아있으면 평가기준 유지 확인
            - **할당 취소 후 검증** 
                - GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data (직원 할당 데이터 조회)
                    - 취소 전후 WBS 수 비교 검증
                    - **대시보드 API 할당 취소 검증** 
                        - 취소된 WBS가 더 이상 할당 목록에 없는지 확인
                        - 남은 WBS들의 wbsId 검증
                        - WBS 정보 일치 확인
                - GET /admin/dashboard/{evaluationPeriodId}/employees/status (대시보드 직원 현황 조회)
                    - evaluationCriteria.assignedWbsCount 감소 확인
    - **WBS 초기화 관리** 
        - DELETE /admin/evaluation-criteria/wbs-assignments/period/{periodId} (평가기간의 WBS 할당 초기화) 
            - 해당 평가기간의 모든 WBS 할당 삭제
            - **평가기준 정리 검증** 
                - 초기화된 할당과 연관된 평가기준 자동 삭제 확인
            - HTTP 200 응답으로 성공 확인
            - 멱등성 보장: 이미 초기화된 평가기간을 다시 초기화해도 오류 없이 성공 처리
        - DELETE /admin/evaluation-criteria/wbs-assignments/project/{projectId}/period/{periodId} (프로젝트의 WBS 할당 초기화) 
            - 특정 프로젝트의 특정 평가기간 WBS 할당 삭제
            - **평가기준 정리 검증** 
                - 초기화된 할당과 연관된 평가기준 자동 삭제 확인
            - HTTP 200 응답으로 성공 확인
            - 다른 프로젝트의 할당은 영향받지 않음 확인
        - DELETE /admin/evaluation-criteria/wbs-assignments/employee/{employeeId}/period/{periodId} (직원의 WBS 할당 초기화) 
            - 특정 직원의 특정 평가기간 WBS 할당 삭제 (모든 프로젝트 포함)
            - **평가기준 정리 검증** 
                - 초기화된 할당과 연관된 평가기준 자동 삭제 확인
            - HTTP 200 응답으로 성공 확인
            - 다른 직원의 할당은 영향받지 않음 확인
    - **WBS 생성 및 할당** 
        - POST /admin/evaluation-criteria/project-assignments (프로젝트 할당 생성 - 선행 조건) 
            - employeeId, projectId, periodId로 프로젝트 할당 생성
            - WBS 생성 및 할당 전 필수 선행 조건이므로 먼저 생성
        - POST /admin/evaluation-criteria/wbs-assignments/create-and-assign (WBS 생성하면서 할당) 
            - WBS 항목을 새로 생성하면서 동시에 직원에게 할당
            - 프로젝트 할당이 위에서 생성되었으므로 정상 생성됨
            - **WBS 코드 자동 생성 검증** 
                - 프로젝트 내 기존 WBS 개수를 조회하여 "WBS-001", "WBS-002" 형식으로 순차 생성 확인
            - **WBS 기본값 설정 검증** 
                - status는 PENDING, level은 1(최상위), assignedToId는 employeeId와 동일 확인
            - **평가기준 자동 생성 검증** 
                - WBS 항목에 빈 평가기준 자동 생성 확인
            - **평가라인 자동 구성 검증** 
                - 1차 평가자(관리자), 2차 평가자(PM) 자동 설정 확인
            - **대시보드 API 생성 및 할당 검증** 
                - GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data (직원 할당 데이터 조회)
                    - 새로 생성된 WBS의 wbsId, wbsName, wbsCode 검증
                    - WBS 정보 일치 확인
    - **WBS 항목 이름 수정** 
        - PATCH /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId}/title (WBS 항목 이름 수정) 
            - 기존 WBS 항목의 제목(title) 수정
            - 할당 관계는 유지됨 확인
            - HTTP 200 응답으로 성공 확인
            - **대시보드 API 이름 수정 검증** 
                - GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data (직원 할당 데이터 조회)
                    - 수정된 wbsName이 반영되었는지 확인

- **WBS 할당 정책 검증** 
    - POST /admin/evaluation-periods (평가기간 생성) 
    - POST /admin/evaluation-periods/{id}/start (평가기간 시작) 
    - POST /admin/evaluation-periods/{id}/complete (평가기간 완료) 
    - POST /admin/evaluation-criteria/wbs-assignments (프로젝트 할당 없이 WBS 할당 시도) 
        - **프로젝트 할당 없이 할당 시도 검증** 
            - 프로젝트 할당을 생성하지 않고 WBS 할당 생성 시도
            - HTTP 404 Not Found 또는 422 UnprocessableEntity 응답 확인
            - "프로젝트 할당이 존재하지 않습니다." 또는 유사한 에러 메시지 검증
        - **프로젝트 할당 후 할당 시도 검증** 
            - POST /admin/evaluation-criteria/project-assignments (프로젝트 할당 생성)
            - 프로젝트 할당 생성 후 WBS 할당 생성 시도
            - HTTP 201 Created 응답 확인
            - 정상적으로 WBS 할당이 생성됨을 검증
    - POST /admin/evaluation-criteria/wbs-assignments (완료된 평가기간에 할당 시도) 
        - **완료된 평가기간 할당 불가 검증** 
            - 평가기간을 완료 상태로 변경
            - 완료된 평가기간에 WBS 할당 시도
            - HTTP 422 UnprocessableEntity 응답 확인
            - "완료된 평가기간에는 WBS 할당을 생성할 수 없습니다." 에러 메시지 검증
        - **대량 할당도 동일한 정책 적용** 
            - POST /admin/evaluation-criteria/wbs-assignments/bulk (완료된 평가기간에 대량 할당 시도)
            - HTTP 422 UnprocessableEntity 응답 확인
            - 대량 할당도 완료된 평가기간에서는 불가능함을 검증
        - **할당 취소도 동일한 정책 적용** 
            - DELETE /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId} (완료된 평가기간에 할당 취소 시도)
            - HTTP 422 UnprocessableEntity 응답 확인
            - "완료된 평가기간에는 WBS 할당을 취소할 수 없습니다." 에러 메시지 검증
        - **순서 변경도 동일한 정책 적용** 
            - PATCH /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId}/order (완료된 평가기간에 순서 변경 시도)
            - HTTP 422 UnprocessableEntity 응답 확인
            - "완료된 평가기간에는 WBS 할당 순서를 변경할 수 없습니다." 에러 메시지 검증
        - **WBS 생성 및 할당도 동일한 정책 적용** 
            - POST /admin/evaluation-criteria/wbs-assignments/create-and-assign (완료된 평가기간에 WBS 생성 및 할당 시도)
            - HTTP 422 UnprocessableEntity 응답 확인
            - "완료된 평가기간에는 WBS를 생성하고 할당할 수 없습니다." 에러 메시지 검증
    - POST /admin/evaluation-criteria/wbs-assignments (중복 할당 시도) 
        - **중복 할당 방지 검증** 
            - 동일한 employeeId, wbsItemId, projectId, periodId 조합으로 중복 할당 시도
            - HTTP 409 Conflict 응답 확인
            - "이미 할당된 WBS입니다." 에러 메시지 검증
    - POST /admin/evaluation-criteria/wbs-assignments (존재하지 않는 리소스로 할당 시도) 
        - **존재하지 않는 직원 할당 시도** 
            - POST /admin/evaluation-criteria/project-assignments (프로젝트 할당은 먼저 생성)
            - 존재하지 않는 employeeId로 WBS 할당 시도
            - HTTP 404 Not Found 응답 확인
        - **존재하지 않는 WBS 항목 할당 시도** 
            - POST /admin/evaluation-criteria/project-assignments (프로젝트 할당은 먼저 생성)
            - 존재하지 않는 wbsItemId로 WBS 할당 시도
            - HTTP 404 Not Found 응답 확인
        - **존재하지 않는 프로젝트 할당 시도** 
            - 존재하지 않는 projectId로 프로젝트 할당 생성 시도
            - HTTP 404 Not Found 응답 확인
            - 프로젝트 할당이 실패하면 WBS 할당도 불가능
        - **존재하지 않는 평가기간 할당 시도** 
            - 존재하지 않는 periodId로 프로젝트 할당 생성 시도
            - HTTP 404 Not Found 응답 확인
            - 프로젝트 할당이 실패하면 WBS 할당도 불가능
