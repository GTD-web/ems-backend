# WBS 할당 관리 검증 체크리스트

## 📋 현재 상태
- **WBS 할당 E2E 테스트 파일**: ❌ 존재하지 않음
- **README.md 검증 항목**: ✅ 작성 완료

## 🔍 컨트롤러 메서드별 검증 상태

### 1. `POST /admin/evaluation-criteria/wbs-assignments` (createWbsAssignment)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ 할당 생성 검증
  - [ ] employeeId, wbsItemId, projectId, periodId로 할당 생성 확인
  - [ ] 프로젝트 할당 선행 조건 확인
  - [ ] assignedBy 자동 설정 확인
  - [ ] 할당 ID 반환 확인
- ✅ 평가기준 자동 생성 검증
  - [ ] WBS 항목에 평가기준이 없는 경우 빈 평가기준 자동 생성 확인
- ✅ 평가라인 자동 구성 검증
  - [ ] 1차 평가자(관리자), 2차 평가자(PM) 자동 설정 확인
  - [ ] PM이 관리자와 같은 경우 2차 평가자 미설정 확인
- ✅ 대시보드 할당 검증
  - [ ] GET /admin/dashboard/{evaluationPeriodId}/employees/status
    - [ ] evaluationCriteria.status 확인
    - [ ] evaluationCriteria.assignedWbsCount 확인
  - [ ] GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data
    - [ ] employee 정보 확인
    - [ ] projects 배열 확인
    - [ ] projects[].wbsList 배열 확인
    - [ ] 할당된 WBS ID 검증 (wbsId, wbsName, wbsCode, assignedAt, weight, criteria)

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 2. `DELETE /admin/evaluation-criteria/wbs-assignments/{id}` (cancelWbsAssignment)
**컨트롤러 메서드**: ⚠️ Deprecated  
**검증 항목 (README.md)**: 없음 (WBS ID 기반 취소 사용 권장)

**상태**: ⚠️ Deprecated 메서드, 검증 불필요

---

### 3. `DELETE /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId}` (cancelWbsAssignmentByWbs)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ 할당 취소 검증
  - [ ] employeeId, projectId, periodId를 body로 전달
  - [ ] HTTP 200 응답 확인
- ✅ 평가기준 정리 검증
  - [ ] 해당 WBS의 마지막 할당인 경우 평가기준도 자동 삭제 확인
  - [ ] 다른 할당이 남아있으면 평가기준 유지 확인
- ✅ 할당 취소 후 검증
  - [ ] GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data
    - [ ] 취소 전후 WBS 수 비교 검증
    - [ ] 취소된 WBS가 더 이상 할당 목록에 없는지 확인
    - [ ] 남은 WBS들의 wbsId 검증
    - [ ] WBS 정보 일치 확인
  - [ ] GET /admin/dashboard/{evaluationPeriodId}/employees/status
    - [ ] evaluationCriteria.assignedWbsCount 감소 확인

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 4. `GET /admin/evaluation-criteria/wbs-assignments` (getWbsAssignmentList)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ WBS 할당 목록 조회
  - [ ] periodId, employeeId, projectId, wbsItemId로 필터링 가능
  - [ ] 페이징 및 정렬 지원

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 5. `GET /admin/evaluation-criteria/wbs-assignments/employee/{employeeId}/period/{periodId}` (getEmployeeWbsAssignments)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ 직원별 할당 WBS 조회
  - [ ] 특정 직원의 특정 평가기간 할당 WBS 목록
  - [ ] WBS 할당 후 조회하여 데이터 검증
- ✅ 대시보드 API 추가 검증
  - [ ] GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data
    - [ ] 할당된 WBS의 wbsId 검증
    - [ ] WBS 정보 일치 확인

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 6. `GET /admin/evaluation-criteria/wbs-assignments/project/{projectId}/period/{periodId}` (getProjectWbsAssignments)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ 프로젝트별 할당 WBS 조회
  - [ ] 특정 프로젝트의 특정 평가기간 할당 WBS 목록
  - [ ] WBS 할당 후 조회하여 데이터 검증
- ✅ 대시보드 API 추가 검증
  - [ ] GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data
    - [ ] 할당된 WBS의 wbsId 검증
    - [ ] WBS 정보 일치 확인

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 7. `GET /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId}/period/{periodId}` (getWbsItemAssignments)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ WBS 항목별 할당된 직원 조회
  - [ ] 특정 WBS 항목의 특정 평가기간 할당된 직원 목록
  - [ ] WBS 할당 후 조회하여 데이터 검증

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 8. `GET /admin/evaluation-criteria/wbs-assignments/unassigned` (getUnassignedWbsItems)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ 미할당 WBS 항목 조회
  - [ ] periodId, projectId, employeeId(선택)로 미할당 WBS 항목 목록 조회

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 9. `GET /admin/evaluation-criteria/wbs-assignments/detail` (getWbsAssignmentDetail)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ WBS 할당 상세 조회
  - [ ] employeeId, wbsItemId, projectId, periodId로 상세 정보 조회
  - [ ] employee, project, wbsItem, evaluationPeriod 중첩 객체 구조 검증

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 10. `POST /admin/evaluation-criteria/wbs-assignments/bulk` (bulkCreateWbsAssignments)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ WBS 대량 할당
  - [ ] 여러 직원을 여러 WBS 항목에 한 번에 할당
  - [ ] assignments 배열로 다중 할당 처리
  - [ ] 프로젝트 할당 선행 조건 확인
- ✅ 평가기준 자동 생성 검증
  - [ ] 각 WBS 항목에 평가기준이 없는 경우 빈 평가기준 자동 생성 확인
- ✅ 평가라인 자동 구성 검증
  - [ ] 각 할당마다 1차, 2차 평가자 자동 설정 확인
- ✅ 대시보드 API 대량 할당 검증
  - [ ] 각 할당에 대해 GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data 호출
  - [ ] 할당된 WBS의 wbsId, wbsName, wbsCode 검증
  - [ ] 할당 시점(assignedAt) 및 가중치(weight) 정보 확인
  - [ ] 평가기준(criteria) 배열 확인

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 11. `DELETE /admin/evaluation-criteria/wbs-assignments/period/{periodId}` (resetPeriodWbsAssignments)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ 평가기간의 WBS 할당 초기화
  - [ ] 해당 평가기간의 모든 WBS 할당 삭제
  - [ ] 평가기준 정리 검증 (초기화된 할당과 연관된 평가기준 자동 삭제 확인)
  - [ ] HTTP 200 응답 확인
  - [ ] 멱등성 보장: 이미 초기화된 평가기간을 다시 초기화해도 오류 없이 성공 처리

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 12. `DELETE /admin/evaluation-criteria/wbs-assignments/project/{projectId}/period/{periodId}` (resetProjectWbsAssignments)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ 프로젝트의 WBS 할당 초기화
  - [ ] 특정 프로젝트의 특정 평가기간 WBS 할당 삭제
  - [ ] 평가기준 정리 검증 (초기화된 할당과 연관된 평가기준 자동 삭제 확인)
  - [ ] HTTP 200 응답 확인
  - [ ] 다른 프로젝트의 할당은 영향받지 않음 확인

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 13. `DELETE /admin/evaluation-criteria/wbs-assignments/employee/{employeeId}/period/{periodId}` (resetEmployeeWbsAssignments)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ 직원의 WBS 할당 초기화
  - [ ] 특정 직원의 특정 평가기간 WBS 할당 삭제 (모든 프로젝트 포함)
  - [ ] 평가기준 정리 검증 (초기화된 할당과 연관된 평가기준 자동 삭제 확인)
  - [ ] HTTP 200 응답 확인
  - [ ] 다른 직원의 할당은 영향받지 않음 확인

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 14. `PATCH /admin/evaluation-criteria/wbs-assignments/{id}/order` (changeWbsAssignmentOrder)
**컨트롤러 메서드**: ⚠️ Deprecated  
**검증 항목 (README.md)**: 없음 (WBS ID 기반 순서 변경 사용 권장)

**상태**: ⚠️ Deprecated 메서드, 검증 불필요

---

### 15. `PATCH /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId}/order` (changeWbsAssignmentOrderByWbs)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ WBS 할당 순서 변경
  - [ ] direction: "up" | "down"으로 순서 변경
  - [ ] employeeId, projectId, periodId를 body로 전달
- ✅ 순서 변경 검증
  - [ ] 여러 WBS 할당 후 순서 변경 테스트
  - [ ] 변경 전후 WBS 순서 비교 검증
  - [ ] GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data
    - [ ] projects[].wbsList 배열의 실제 순서 변경 확인
    - [ ] summary.totalWbsCount 확인
    - [ ] 첫 번째 WBS가 변경되었는지 검증
    - [ ] 할당된 WBS의 wbsId로 정확한 WBS가 순서 변경되었는지 확인
    - [ ] WBS 정보(wbsName, wbsCode) 일치 확인

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 16. `POST /admin/evaluation-criteria/wbs-assignments/create-and-assign` (createAndAssignWbs)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ WBS 생성 및 할당
  - [ ] WBS 항목을 새로 생성하면서 동시에 직원에게 할당
  - [ ] 프로젝트 할당 선행 조건 확인
- ✅ WBS 코드 자동 생성 검증
  - [ ] 프로젝트 내 기존 WBS 개수를 조회하여 "WBS-001", "WBS-002" 형식으로 순차 생성 확인
- ✅ WBS 기본값 설정 검증
  - [ ] status는 PENDING, level은 1(최상위), assignedToId는 employeeId와 동일 확인
- ✅ 평가기준 자동 생성 검증
  - [ ] WBS 항목에 빈 평가기준 자동 생성 확인
- ✅ 평가라인 자동 구성 검증
  - [ ] 1차 평가자(관리자), 2차 평가자(PM) 자동 설정 확인
- ✅ 대시보드 API 생성 및 할당 검증
  - [ ] GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data
    - [ ] 새로 생성된 WBS의 wbsId, wbsName, wbsCode 검증
    - [ ] WBS 정보 일치 확인

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

### 17. `PATCH /admin/evaluation-criteria/wbs-assignments/wbs-item/{wbsItemId}/title` (updateWbsItemTitle)
**컨트롤러 메서드**: ✅ 존재  
**검증 항목 (README.md)**:
- ✅ WBS 항목 이름 수정
  - [ ] 기존 WBS 항목의 제목(title) 수정
  - [ ] 할당 관계는 유지됨 확인
  - [ ] HTTP 200 응답 확인
- ✅ 대시보드 API 이름 수정 검증
  - [ ] GET /admin/dashboard/{evaluationPeriodId}/employees/{employeeId}/assigned-data
    - [ ] 수정된 wbsName이 반영되었는지 확인

**상태**: ❌ 테스트 파일 없음, 모든 검증 누락

---

## 🔐 정책 검증 항목 (README.md)

### 프로젝트 할당 없이 WBS 할당 시도
- [ ] 프로젝트 할당을 생성하지 않고 WBS 할당 생성 시도
- [ ] HTTP 404 Not Found 또는 422 UnprocessableEntity 응답 확인
- [ ] "프로젝트 할당이 존재하지 않습니다." 또는 유사한 에러 메시지 검증
- [ ] 프로젝트 할당 생성 후 WBS 할당 생성 시도 → HTTP 201 Created 확인

### 완료된 평가기간 정책 검증
- [ ] 완료된 평가기간에 WBS 할당 시도 → HTTP 422 응답
- [ ] 완료된 평가기간에 대량 할당 시도 → HTTP 422 응답
- [ ] 완료된 평가기간에 할당 취소 시도 → HTTP 422 응답
- [ ] 완료된 평가기간에 순서 변경 시도 → HTTP 422 응답
- [ ] 완료된 평가기간에 WBS 생성 및 할당 시도 → HTTP 422 응답

### 중복 할당 방지
- [ ] 동일한 employeeId, wbsItemId, projectId, periodId 조합으로 중복 할당 시도
- [ ] HTTP 409 Conflict 응답 확인
- [ ] "이미 할당된 WBS입니다." 에러 메시지 검증

### 존재하지 않는 리소스 검증
- [ ] 존재하지 않는 employeeId로 WBS 할당 시도 → HTTP 404
- [ ] 존재하지 않는 wbsItemId로 WBS 할당 시도 → HTTP 404
- [ ] 존재하지 않는 projectId로 프로젝트 할당 생성 시도 → HTTP 404
- [ ] 존재하지 않는 periodId로 프로젝트 할당 생성 시도 → HTTP 404

**상태**: ❌ 테스트 파일 없음, 모든 정책 검증 누락

---

## 📊 전체 요약

### 통계
- **컨트롤러 메서드**: 17개
- **Deprecated 메서드**: 2개 (검증 불필요)
- **검증 필요 메서드**: 15개
- **검증 완료**: 0개 (0%)
- **검증 누락**: 15개 (100%)

### 우선순위별 구현 권장사항
1. **높은 우선순위**: WBS 할당 기본 관리 (createWbsAssignment, cancelWbsAssignmentByWbs, getEmployeeWbsAssignments)
2. **중간 우선순위**: WBS 대량 할당 관리, 순서 변경, WBS 생성 및 할당
3. **낮은 우선순위**: 초기화 관리, 정책 검증

---

## 🎯 다음 단계
1. WBS 할당 E2E 테스트 파일 생성 (`wbs-assignment-basic-management.e2e-spec.ts`)
2. WBS 할당 시나리오 클래스 생성 (`wbs-assignment.scenario.ts`)
3. README.md에 명시된 모든 검증 항목 구현
4. 프로젝트 할당 E2E 테스트 참고하여 유사한 구조로 작성
