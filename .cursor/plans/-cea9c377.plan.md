<!-- cea9c377-0cc9-4976-97c9-1ecb1d070691 b577e148-befe-4ce9-9a6f-c8b1158fead6 -->
# 단계별 승인 시 제출 상태 자동 변경

## 개요

제출되지 않은 상태에서 단계별 승인(APPROVED) 처리 시 제출 상태도 자동으로 true로 변경되도록 구현합니다.

- 자기평가 승인 시: `submittedToEvaluator`와 `submittedToManager` 모두 true로 설정
- 1차 하향평가 승인 시: 해당 평가의 `isCompleted`를 true로 설정
- 2차 하향평가 승인 시: 해당 평가의 `isCompleted`를 true로 설정
- 검증은 불필요 (승인만 처리)

## 구현 계획

### 1. StepApprovalBusinessService 생성

**파일**: `src/business/step-approval/step-approval-business.service.ts` (신규)

- 단계 승인 처리용 비즈니스 서비스 생성
- StepApprovalContextService, PerformanceEvaluationService 등을 연계하여 사용
- `자기평가_승인_시_제출상태_변경` 메서드 추가
- 평가기간과 직원 ID로 해당 기간의 모든 자기평가 조회
- `submittedToEvaluator`와 `submittedToManager` 모두 true로 설정
- PerformanceEvaluationService의 기존 메서드 활용
- `일차_하향평가_승인_시_제출상태_변경` 메서드 추가
- 평가기간, 직원 ID, 1차 평가자 ID로 해당 평가 조회
- `isCompleted`를 true로 설정
- PerformanceEvaluationService의 기존 메서드 활용
- `이차_하향평가_승인_시_제출상태_변경` 메서드 추가
- 평가기간, 직원 ID, 2차 평가자 ID로 해당 평가 조회
- `isCompleted`를 true로 설정
- PerformanceEvaluationService의 기존 메서드 활용

**파일**: `src/business/step-approval/step-approval-business.module.ts` (신규)

- StepApprovalBusinessService를 제공하는 모듈 생성
- 필요한 컨텍스트 서비스들을 import
- BusinessModule에 추가

### 2. PerformanceEvaluationService에 제출 상태 변경 메서드 확인/추가

**파일**: `src/context/performance-evaluation-context/performance-evaluation.service.ts`

- 자기평가 제출 상태 변경 메서드 확인
- 기존 메서드 활용 가능 여부 확인
- 필요 시 새 메서드 추가

- 하향평가 제출 상태 변경 메서드 확인
- 기존 메서드 활용 가능 여부 확인
- 필요 시 새 메서드 추가

### 3. StepApprovalController 수정

**파일**: `src/interface/admin/step-approval/step-approval.controller.ts`

- `StepApprovalBusinessService` 주입
- `updateSelfStepApproval` 메서드 수정
- `APPROVED` 상태로 변경 시 `stepApprovalBusinessService.자기평가_승인_시_제출상태_변경` 호출
- 기존 재작성 요청 로직은 유지
- `updatePrimaryStepApproval` 메서드 수정
- `APPROVED` 상태로 변경 시 `stepApprovalBusinessService.일차_하향평가_승인_시_제출상태_변경` 호출
- 기존 재작성 요청 로직은 유지
- `updateSecondaryStepApproval` 메서드 수정
- `APPROVED` 상태로 변경 시 `stepApprovalBusinessService.이차_하향평가_승인_시_제출상태_변경` 호출
- 기존 재작성 요청 로직은 유지

### 4. 구현 세부사항

- 제출 상태 변경은 검증 없이 처리 (승인만 처리)
- 이미 제출된 상태에서 승인해도 에러 없이 처리 (idempotent)
- 트랜잭션 처리 고려 (기존 로직과 일관성 유지)
- 로깅 추가 (제출 상태 변경 로그)

## 주요 변경 파일

1. `src/business/wbs-self-evaluation/wbs-self-evaluation-business.service.ts`
2. `src/business/downward-evaluation/downward-evaluation-business.service.ts`
3. `src/context/performance-evaluation-context/performance-evaluation.service.ts` (필요 시)
4. `src/interface/admin/step-approval/step-approval.controller.ts`

### To-dos

- [ ] WbsSelfEvaluationBusinessService에 자기평가 승인 시 제출 상태 변경 메서드 추가
- [ ] DownwardEvaluationBusinessService에 1차 하향평가 승인 시 제출 상태 변경 메서드 추가
- [ ] DownwardEvaluationBusinessService에 2차 하향평가 승인 시 제출 상태 변경 메서드 추가
- [ ] PerformanceEvaluationService에 필요한 제출 상태 변경 메서드 확인/추가
- [ ] StepApprovalController의 updateSelfStepApproval 메서드에 APPROVED 시 제출 상태 변경 로직 추가
- [ ] StepApprovalController의 updatePrimaryStepApproval 메서드에 APPROVED 시 제출 상태 변경 로직 추가
- [ ] StepApprovalController의 updateSecondaryStepApproval 메서드에 APPROVED 시 제출 상태 변경 로직 추가